\
# Telegram-бот: Топ‑200 BTC адресов по балансу (онлайн)

Этот бот собирает список адресов из нескольких публичных источников (rich‑list страницы блок‑обозревателей), затем **обновляет фактический баланс каждого адреса по данным blockchain.info** и выстраивает **актуальный топ‑200** на момент запроса. Результат отправляется в чат в виде сообщений и/или CSV‑файла.

> ⚠️ Примечание: источники «rich list» не публикуют открытых стабильных API. В проекте используются универсальные парсеры HTML нескольких популярных сайтов (например, blockchair, btc.com, bitinfocharts). Далее баланс каждого адреса уточняется через `https://blockchain.info/rawaddr/<address>`.

## Возможности

- Команда `/top200btc` — собирает и показывает топ‑200 адресов по балансу (в BTC).
- Команда `/csv` — присылает CSV‑файл с текущим топ‑200.
- Агрегация кандидатов из нескольких источников, дедупликация, обновление балансов и сортировка.
- Политика таймаутов/повторов и ограничение параллелизма для снижения нагрузки на источники.

## Быстрый старт

1. Установите зависимости (Linux/Mac):
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   pip install -U pip
   pip install -r requirements.txt
   ```

2. Создайте бота у @BotFather и получите токен, затем создайте файл `.env`:
   ```bash
   cp .env.example .env
   # отредактируйте TELEGRAM_BOT_TOKEN=...
   ```

3. Запустите бота:
   ```bash
   python bot.py
   ```

4. В Telegram откройте чат с ботом и отправьте `/top200btc` или `/csv`.

## Переменные окружения

- `TELEGRAM_BOT_TOKEN` — токен вашего бота (обязателен).
- `MAX_PER_SOURCE` — максимум адресов на один источник (по умолчанию 200).
- `HTTP_TIMEOUT` — таймаут HTTP‑запросов в секундах (по умолчанию 20).

## Как это работает

1. Модуль `sources.py` параллельно собирает кандидатов адресов с нескольких страниц rich‑list.’ов (несколько первых страниц на каждом сайте).
2. Дедуплицирует адреса и для каждого адреса запрашивает баланс через `blockchain.info/rawaddr` (поле `final_balance` в сатоши).
3. Сортирует по балансу и возвращает топ‑200.
4. `bot.py` форматирует результат и отсылает в чат chunk’ами (чтобы не превысить лимит символов Telegram).

## Ограничения и примечания

- Если какой‑то сайт поменяет вёрстку или закроет доступ, соответствующий парсер может временно вернуть меньше адресов. Система устойчиво продолжит работу за счёт других источников и повторов.
- Некоторые крупнейшие адреса могут принадлежать биржам и кошелькам‑пулами; бот **не делает кластеризацию** и **не помечает биржи** (можно расширить при желании).
- Обновление балансов живыми запросами занимает время (обычно 1–3 минуты).

## Расширение (опционально)

- Добавить другие источники (например, OKLink Rich List через API‑ключ, если доступен).
- Кешировать результаты на 1–5 минут, чтобы ускорять повторные запросы в активных чатах.
- Добавить подписи «вероятно биржа» по словарю известных адресов бирж.
- Отправлять также JSON‑файл с данными.

## Команды

- `/start`, `/help` — помощь
- `/top200btc` — показать топ‑200 сейчас
- `/csv` — прислать CSV файл

Удачи!
